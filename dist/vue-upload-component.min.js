/*!
 * Name: vue-upload-component
 * Version: 2.6.3
 * Author: LianYue
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueUploadComponent=t()}(this,function(){"use strict";function e(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText="":t.appendChild(document.createTextNode("")),e.appendChild(t)}}();var t={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{attrs:{type:"file",name:e.$parent.name,id:e.$parent.inputId||e.$parent.name,accept:e.$parent.accept,webkitdirectory:e.$parent.directory&&e.$parent.features.directory,directory:e.$parent.directory&&e.$parent.features.directory,multiple:e.$parent.multiple&&e.$parent.features.html5},on:{change:e.change}})},staticRenderFns:[],methods:{change:function(e){this.$destroy(),this.$parent.addInputFile(e.target),new this.constructor({parent:this.$parent,el:this.$el})}}},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),r=' .file-uploads { overflow: hidden; position: relative; text-align: center; display: inline-block; } .file-uploads.file-uploads-html4 input[type="file"] { opacity: 0; font-size: 20em; z-index: 1; top: 0; left: 0; right: 0; bottom: 0; position: absolute; width: 100%; height: 100%; } .file-uploads.file-uploads-html5 input[type="file"] { overflow: hidden; position: fixed; width: 1px; height: 1px; z-index: -1; opacity: 0; } ';t.type="text/css",t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r)),e.appendChild(t)}}();var n={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("label",{class:e.className},[e._t("default"),e._v(" "),r("input-file")],2)},staticRenderFns:[],components:{InputFile:t},props:{inputId:{type:String},name:{type:String,default:"file"},accept:{type:String},multiple:{type:Boolean},addIndex:{type:[Boolean,Number]},directory:{type:Boolean},postAction:{type:String},putAction:{type:String},headers:{type:Object,default:Object},data:{type:Object,default:Object},timeout:{type:Number,default:0},drop:{default:!1},dropDirectory:{type:Boolean,default:!0},size:{type:Number,default:0},extensions:{default:Array},value:{type:Array,default:Array},thread:{type:Number,default:1}},data:function(){return{files:this.value,features:{html5:!0,directory:!1,drag:!1},active:!1,dropActive:!1,uploading:0,destroy:!1}},mounted:function(){var e=document.createElement("input");e.type="file",e.multiple=!0,window.FormData&&e.files?("boolean"!=typeof e.webkitdirectory&&"boolean"!=typeof e.directory||(this.features.directory=!0),this.features.html5&&void 0!==e.ondrop&&(this.features.drop=!0)):this.features.html5=!1,this.maps={},this.$nextTick(function(){this.$parent&&this.$parent.$forceUpdate(),this.watchDrop(this.drop)})},beforeDestroy:function(){this.destroy=!0,this.active=!1},computed:{uploaded:function(){for(var e=void 0,t=0;t<this.files.length;t++)if((e=this.files[t]).fileObject&&!e.error&&!e.success)return!1;return!0},className:function(){return["file-uploads",this.features.html5?"file-uploads-html5":"file-uploads-html4",this.features.directory&&this.directory?"file-uploads-directory":void 0,this.features.drop&&this.drop?"file-uploads-drop":void 0]}},watch:{active:function(e){this.watchActive(e)},dropActive:function(){this.$parent&&this.$parent.$forceUpdate()},drop:function(e){this.watchDrop(e)},value:function(e){if(this.files!==e){this.files=e;var t=this.maps;this.maps={};for(var r=0;r<this.files.length;r++){var i=this.files[r];this.maps[i.id]=i}for(var n in this.maps){var o=this.maps[n],a=t[n];o!==a&&this.emitFile(o,a)}for(var s in t)this.maps[s]||this.emitFile(void 0,t[s])}}},methods:{clear:function(){if(this.files.length){var e=this.files;this.files=[],this.maps={},this.emitInput();for(var t=0;t<e.length;t++)this.emitFile(void 0,e[t])}return!0},get:function(e){return!!e&&("object"===(void 0===e?"undefined":i(e))?this.maps[e.id]||!1:this.maps[e]||!1)},add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.addIndex,i=e,n=i instanceof Array;n||(i=[i]);for(var o=[],a=0;a<i.length;a++){var s=i[a];this.features.html5&&s instanceof Blob&&(s={file:s,size:s.size,name:s.webkitRelativePath||s.relativePath||s.name||"unknown",type:s.type});var u=!1;if(!1===s.fileObject||(s.fileObject?u=!0:"undefined"!=typeof Element&&s.el instanceof Element?u=!0:"undefined"!=typeof Blob&&s.file instanceof Blob&&(u=!0)),u&&((s=r({fileObject:!0,size:-1,name:"Filename",type:"",active:!1,error:"",success:!1,putAction:this.putAction,postAction:this.postAction,timeout:this.timeout},s,{response:{},progress:"0.00",speed:0})).data=r({},this.data,s.data?s.data:{}),s.headers=r({},this.headers,s.headers?s.headers:{})),s.id||(s.id=Math.random().toString(36).substr(2)),!this.emitFilter(s,void 0)&&(o.push(s),!this.multiple))break}if(!o.length)return!1;this.multiple||this.clear();var d=void 0;!0===t||0===t?d=o.concat(this.files):t?(d=o.concat([])).splice(t,0,o):d=this.files.concat(o),this.files=d;for(var l=0;l<o.length;l++){var c=o[l];this.maps[c.id]=c}this.emitInput();for(var f=0;f<o.length;f++)this.emitFile(o[f],void 0);return n?o:o[0]},addInputFile:function(e){var t=[];if(e.files)for(var r=0;r<e.files.length;r++){var i=e.files[r];t.push({size:i.size,name:i.webkitRelativePath||i.relativePath||i.name,type:i.type,file:i,el:e})}else t.push({name:e.value.replace(/^.*?([^\/\\\r\n]+)$/,"$1"),el:e});return this.add(t)},addDataTransfer:function(t){var r=this,i=[];if(t.items&&t.items.length){for(var n=[],o=0;o<t.items.length;o++){var a=t.items[o];(a=a.getAsEntry?a.getAsEntry():a.webkitGetAsEntry?a.webkitGetAsEntry():a.getAsFile())&&n.push(a)}return new Promise(function(t,o){!function o(a){var s=n[a];if(!s||!r.multiple&&i.length)return t(r.add(i));r.getEntry(s).then(function(t){i.push.apply(i,e(t)),o(a+1)})}(0)})}if(t.files.length){for(var s=0;s<t.files.length&&(i.push(t.files[s]),this.multiple);s++);return Promise.resolve(this.add(i))}return Promise.resolve([])},getEntry:function(t){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(n,o){t.isFile?t.file(function(e){n([{size:e.size,name:i+e.name,type:e.type,file:e}])}):t.isDirectory&&r.dropDirectory?t.createReader().readEntries(function(o){var a=[];!function s(u){if(!o[u]||a.length&&!r.multiple)return n(a);r.getEntry(o[u],i+t.name+"/").then(function(t){a.push.apply(a,e(t)),s(u+1)})}(0)}):n([])})},replace:function(e,t){var r=this.get(e),i=this.get(t);if(!r||!i||r===i)return!1;var n=this.files.concat([]),o=n.indexOf(r),a=n.indexOf(i);return-1!==o&&-1!==a&&(n[o]=i,n[a]=r,this.files=n,this.emitInput(),!0)},remove:function(e){var t=this.get(e);if(t){if(this.emitFilter(void 0,t))return!1;var r=this.files.concat([]),i=r.indexOf(t);if(-1===i)return console.error("remove",t),!1;r.splice(i,1),this.files=r,delete this.maps[t.id],this.emitInput(),this.emitFile(void 0,t)}return t},update:function(e,t){var i=this.get(e);if(i){var n=r({},i,t);if(!i.fileObject||!i.active||n.active||n.error||n.success||(n.error="abort"),this.emitFilter(n,i))return!1;var o=this.files.concat([]),a=o.indexOf(i);return-1===a?(console.error("update",i),!1):(o.splice(a,1,n),this.files=o,delete this.maps[i.id],this.maps[n.id]=n,this.emitInput(),this.emitFile(n,i),n)}return!1},emitFilter:function(e,t){var r=!1;return this.$emit("input-filter",e,t,function(){return r=!0}),r},emitFile:function(e,t){this.$emit("input-file",e,t),!(e&&e.fileObject&&e.active)||t&&t.active?e&&e.fileObject&&e.active||!t||!t.fileObject||!t.active||this.uploading--:(this.uploading++,this.$nextTick(function(){var t=this;setTimeout(function(){t.upload(e).then(function(){(e=t.get(e))&&e.fileObject&&t.update(e,{active:!1,success:!e.error})}).catch(function(r){t.update(e,{active:!1,success:!1,error:r.code||r.error||r.message||r})})},parseInt(50*Math.random()+50,10))})),!this.active||Boolean(e)===Boolean(t)&&e.active===t.active||this.watchActive(!0)},emitInput:function(){this.$emit("input",this.files)},upload:function(e){var t=this.get(e);if(!t)return Promise.reject("not_exists");if(!t.fileObject)return Promise.reject("file_object");if(t.error)return Promise.reject(t.error);if(t.success)return Promise.resolve(t);var r=this.extensions;return r&&(r.length||void 0===r.length)&&("object"===(void 0===r?"undefined":i(r))&&r instanceof RegExp||("string"==typeof r&&(r=r.split(",").map(function(e){return e.trim()}).filter(function(e){return e})),r=new RegExp("\\.("+r.join("|").replace(/\./g,"\\.")+")$","i")),-1===t.name.search(r))?Promise.reject("extension"):this.size>0&&t.size>=0&&t.size>this.size?Promise.reject("size"):this.features.html5&&t.putAction?this.uploadPut(t):this.features.html5?this.uploadHtml5(t):this.uploadHtml4(t)},uploadPut:function(e){var t=[],r=void 0;for(var i in e.data)null!==(r=e.data[i])&&void 0!==r&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(r));var n=t.length?(-1===e.putAction.indexOf("?")?"?":"&")+t.join("&"):"",o=new XMLHttpRequest;return o.open("PUT",e.putAction+n),this.uploadXhr(o,e,e.file)},uploadHtml5:function(e){var t=new window.FormData,r=void 0;for(var n in e.data)(r=e.data[n])&&"object"===(void 0===r?"undefined":i(r))&&"function"!=typeof r.toString?r instanceof File?t.append(n,r,r.name):t.append(n,JSON.stringify(r)):null!==r&&void 0!==r&&t.append(n,r);t.append(this.name,e.file,e.file.filename||e.name);var o=new XMLHttpRequest;return o.open("POST",e.postAction),this.uploadXhr(o,e,t)},uploadXhr:function(e,t,r){var i=this,n=t,o=0,a=0;e.upload.onprogress=function(e){if(n=i.get(n),e.lengthComputable&&n&&n.fileObject&&n.active){var t=Math.round(Date.now()/1e3);t!==o&&(o=t,n=i.update(n,{progress:(e.loaded/e.total*100).toFixed(2),speed:e.loaded-a}),a=e.loaded)}};var s=setInterval(function(){if(!(n=i.get(n))||!n.fileObject||n.success||n.error||!n.active){s&&(clearInterval(s),s=!1);try{e.abort(),e.timeout=1}catch(e){}}},100);return new Promise(function(t,o){var a=void 0,u=function(r){if(!a){if(a=!0,s&&(clearInterval(s),s=!1),!(n=i.get(n)))return o("not_exists");if(!n.fileObject)return o("file_object");if(n.error)return o(n.error);if(!n.active)return o("abort");if(n.success)return t(n);var u={};switch(r.type){case"timeout":case"abort":u.error=r.type;break;case"error":e.status?e.status>=500?u.error="server":e.status>=400&&(u.error="denied"):u.error="network";break;default:e.status>=500?u.error="server":e.status>=400?u.error="denied":u.progress="100.00"}if(e.responseText){var d=e.getResponseHeader("Content-Type");d&&-1!==d.indexOf("/json")?u.response=JSON.parse(e.responseText):u.response=e.responseText}return(n=i.update(n,u)).error?o(n.error):t(n)}};e.onload=u,e.onerror=u,e.onabort=u,e.ontimeout=u,n.timeout&&(e.timeout=n.timeout);for(var d in n.headers)e.setRequestHeader(d,n.headers[d]);n=i.update(n,{xhr:e}),e.send(r)})},uploadHtml4:function(e){var t=this,r=e,n=function(e){27===e.keyCode&&e.preventDefault()},o=document.createElement("iframe");o.id="upload-iframe-"+r.id,o.name="upload-iframe-"+r.id,o.src="about:blank",o.setAttribute("style","width:1px;height:1px;top:-999em;position:absolute; margin-top:-999em;");var a=document.createElement("form");a.action=r.postAction,a.name="upload-form-"+r.id,a.setAttribute("method","POST"),a.setAttribute("target","upload-iframe-"+r.id),a.setAttribute("enctype","multipart/form-data");var s=void 0,u=void 0;for(var d in r.data)(s=r.data[d])&&"object"===(void 0===s?"undefined":i(s))&&"function"!=typeof s.toString&&(s=JSON.stringify(s)),null!==s&&void 0!==s&&((u=document.createElement("input")).type="hidden",u.name=d,a.appendChild(u));a.appendChild(r.el),document.body.appendChild(o).appendChild(a);var l=function(){var e=void 0;try{o.contentWindow&&(e=o.contentWindow.document)}catch(e){}if(!e)try{e=o.contentDocument?o.contentDocument:o.document}catch(t){e=o.document}return e&&e.body?e.body.innerHTML:null};return new Promise(function(e,i){setTimeout(function(){if(!(r=t.update(r,{iframe:o})))return i("not_exists");var s=setInterval(function(){(r=t.get(r))&&r.fileObject&&!r.success&&!r.error&&r.active||(s&&(clearInterval(s),s=!1),o.onabort({type:r?"abort":"not_exists"}))},100),u=void 0,d=function(o){if(!u){if(u=!0,s&&(clearInterval(s),s=!1),document.body.removeEventListener("keydown",n),!(r=t.get(r)))return i("not_exists");if(!r.fileObject)return i("file_object");if(r.error)return i(r.error);if(!r.active)return i("abort");if(r.success)return e(r);var a=l(),d={};switch(o.type){case"abort":d.error="abort";break;case"error":r.error?d.error=r.error:d.error=null===a?"network":"denied";break;default:r.error?d.error=r.error:null===d?d.error="network":d.progress="100.00"}if(null!==a){if(a&&"{"===a.substr(0,1)&&"}"===a.substr(a.length-1,1))try{a=JSON.parse(a)}catch(e){}d.response=a}return(r=t.update(r,d)).error?i(r.error):e(r)}};o.onload=d,o.onerror=d,o.onabort=d,document.body.addEventListener("keydown",n),a.submit()},50)}).then(function(e){return o.parentNode&&o.parentNode.removeChild(o),e}).catch(function(e){return o.parentNode&&o.parentNode.removeChild(o),e})},watchActive:function(e){for(var t=void 0,r=0;t=this.files[r];)if(r++,t.fileObject)if(e&&!this.destroy){if(this.uploading>=this.thread||this.uploading&&!this.features.html5)break;t.active||t.error||t.success||this.update(t,{active:!0})}else t.active&&this.update(t,{active:!1});else;0===this.uploading&&(this.active=!1)},watchDrop:function(e){var t=e;if(this.features.drop){if(this.dropElement)try{document.removeEventListener("dragenter",this.onDragenter,!1),document.removeEventListener("dragleave",this.onDragleave,!1),this.dropElement.removeEventListener("dragover",this.onDragover,!1),this.dropElement.removeEventListener("drop",this.onDrop,!1)}catch(e){}t?"string"==typeof t?t=document.querySelector(t)||this.$root.$el.querySelector(t):!0===t&&(t=this.$parent.$el):t=!1,this.dropElement=t,this.dropElement&&(document.addEventListener("dragenter",this.onDragenter,!1),document.addEventListener("dragleave",this.onDragleave,!1),this.dropElement.addEventListener("dragover",this.onDragover,!1),this.dropElement.addEventListener("drop",this.onDrop,!1))}},onDragenter:function(e){e.preventDefault(),this.dropActive||(this.dropActive=!0)},onDragleave:function(e){e.preventDefault(),("HTML"===e.target.nodeName||0===e.screenX&&0===e.screenY&&0===e.screenY&&!e.fromElement&&e.offsetX<0)&&(this.dropActive=!1)},onDragover:function(e){e.preventDefault()},onDrop:function(e){e.preventDefault(),this.dropActive=!1,this.addDataTransfer(e.dataTransfer)}}},o=Object.freeze({default:n});return o&&n||o});
//# sourceMappingURL=vue-upload-component.min.js.map
